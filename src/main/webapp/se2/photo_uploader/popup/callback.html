<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"> 
<html lang="ko">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>FileUploader Callback</title>
</head>
<body>
    <script type="text/javascript">
        console.log("Callback 페이지 로드됨");
        console.log("현재 URL:", window.location.href);
        
        try {
            // URL에서 파라미터 추출
            var urlParams = new URLSearchParams(window.location.search);
            var callbackFunc = urlParams.get('callback_func');
            var uploadPath = urlParams.get('uploadPath');
            var fileName = urlParams.get('fileName');
            
            console.log("콜백함수:", callbackFunc);
            console.log("업로드경로:", uploadPath);
            console.log("파일명:", fileName);
            
            if (uploadPath && fileName) {
                // SmartEditor에 이미지 삽입
                if (parent && parent.oEditors && parent.oEditors.getById) {
                    var editor = parent.oEditors.getById["ir1"];
                    if (editor) {
                        var imgHtml = '<img src="' + uploadPath + '" alt="' + decodeURIComponent(fileName) + '" style="max-width: 100%;" />';
                        editor.exec("PASTE_HTML", [imgHtml]);
                        console.log("이미지 삽입 성공");
                    }
                }
                
                // 팝업 창 닫기
                if (window.opener) {
                    window.close();
                } else if (parent) {
                    // iframe인 경우
                    parent.postMessage('close_popup', '*');
                }
            } else {
                console.error("필수 파라미터가 없습니다.");
                alert("파일 업로드에 문제가 발생했습니다.");
            }
            
        } catch (e) {
            console.error("콜백 처리 오류:", e);
            alert("이미지 삽입 중 오류가 발생했습니다: " + e.message);
            
            // 그래도 팝업은 닫기
            try {
                if (window.opener) {
                    window.close();
                } else if (parent) {
                    parent.postMessage('close_popup', '*');
                }
            } catch (closeError) {
                console.error("창 닫기 오류:", closeError);
            }
        }
    </script>
</body>
</html>